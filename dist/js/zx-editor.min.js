/*!
 * zx-editor v3.0.0-alpha
 * https://github.com/capricorncd/zx-editor
 * Copyright Â© 2018-present, capricorncd
 * Released under the MIT License
 * Released on: 2019-04-27 23:23:38
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ZxEditor=e()}(this,function(){"use strict";function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){for(var e=[],n=0;n<t.length;n+=1)-1===e.indexOf(t[n])&&e.push(t[n]);return e}function n(t,e){var n=t.nodeName.toLowerCase();if("string"!=typeof e||0===u.strip(e).length)throw new TypeError("changeNodeName(oldNode, tagName) 'tagName' is ".concat(e,", should be a 'string'"));if(n===e.toLowerCase())return t;var i=document.createElement(e);if(1!==t.nodeType)i.appendChild(t);else{t.className&&(i.className=t.className),t.id&&(i.id=t.id);var r=t.getAttribute("style");r&&i.setAttribute("style",r),i.innerHTML=t.innerHTML}return t.parentNode&&t.parentNode.replaceChild(i,t),i}var i=[],e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function r(t){var e=parseInt(t);return isNaN(e)?0:e}function s(t){return t?t.toString().replace(e,""):""}function a(t){return s(t).replace(/\s+/g," ")}function h(t,e){var n=t&&"object"===c(t);return e?n&&"[object Object]"===t.toString():n}var u={changeNodeName:n,int:r,isElement:function(t){return h(t)&&t.nodeType},isObject:h,removeHtmlTags:function(t){return a(t=(t+"").replace(/<\/?.+?>/g,""))},slice:function(t,e){return i.slice.call(t,r(e))},strip:a,trim:s,toHump:function(t){return a(t).replace(/([-_\s]+\w)/g,function(t,e){return console.log(t,e),e[1].toUpperCase()})},unique:o},f="undefined"==typeof document?{body:{},addEventListener:function(){},removeEventListener:function(){},activeElement:{blur:function(){},nodeName:""},querySelector:function(){return null},querySelectorAll:function(){return[]},getElementById:function(){return null},createEvent:function(){return{initEvent:function(){}}},createElement:function(){return{children:[],childNodes:[],style:{},setAttribute:function(){},getElementsByTagName:function(){return[]}}},location:{hash:""}}:document,p="undefined"==typeof window?{document:f,navigator:{userAgent:""},location:{},history:{},CustomEvent:function(){return this},addEventListener:function(){},removeEventListener:function(){},getComputedStyle:function(){return{getPropertyValue:function(){return""}}},Image:function(){},Date:function(){},screen:{},setTimeout:function(){},clearTimeout:function(){}}:window;function l(t,e){var n,i=this;if(!t)return this;if(t instanceof l)return t;if("string"==typeof t)if("<"===t[0]&&">"===t[t.length-1]&&3<=t.length){var r=f.createElement("div");r.innerHTML=t,n=u.slice(r.childNodes)}else/^[#\w\d_,\s-]+$/.test(t)&&(e instanceof l&&(e=e[0]),e=u.isElement(e)&&1===e.nodeType?e:f,n=u.slice(e.querySelectorAll(u.strip(t))));else t.nodeType||t===p||t===f?n=[t]:Array.isArray(t)&&t.every(function(t){return u.isElement(t)})&&(n=t);return n&&(n.forEach(function(t,e){i[e]=t}),this.length=n.length),this}l.prototype={constructor:l,length:0,children:function(t){for(var e=[],n=0;n<this.length;n++)for(var i=this[n].childNodes,r=0;r<i.length;r++)t?1===i[r].nodeType&&g(i[r]).is(t)&&e.push(i[r]):1===i[r].nodeType&&e.push(i[r]);return g(o(e))},closest:function(t){var e=this;return void 0===t?new g:(e.is(t)||(e=e.parents(t).eq(0)),e)},eq:function(t){var e=this.length,n=u.int(t)+(t<0?e:0);return g(this[n])},find:function(t){for(var e,n=[],i=0;i<this.length;i++)if(1===this[i].nodeType){e=this[i].querySelectorAll(t);for(var r=0;r<e.length;r++)n.push(e[r])}return g(n)},firstChild:function(){return this.children().eq(0)},lastChild:function(){return this.children().eq(-1)},next:function(t){if(0<this.length){if(t)return this[0].nextElementSibling&&g(this[0].nextElementSibling).is(t)?g([this[0].nextElementSibling]):g();if(this[0].nextElementSibling)return g([this[0].nextElementSibling])}return g()},parent:function(t){for(var e=[],n=0;n<this.length;n++)null!==this[n].parentNode&&(t?g(this[n].parentNode).is(t)&&e.push(this[n].parentNode):e.push(this[n].parentNode));return g(o(e))},parents:function(t){for(var e=[],n=0;n<this.length;n++)for(var i=this[n].parentNode;i;)t?g(i).is(t)&&e.push(i):e.push(i),i=i.parentNode;return g(o(e))},addClass:function(t){var n=this;return t&&t.split(" ").forEach(function(t){for(var e=0;e<n.length;e++)n[e]&&n[e].classList&&n[e].classList.add(t)}),this},removeClass:function(t){var n=this;return t.split(" ").forEach(function(t){for(var e=0;e<n.length;e++)n[e]&&n[e].classList&&n[e].classList.remove(t)}),this},hasClass:function(t){return!!this[0]&&this[0].classList.contains(t)},attr:function(t,e){if(1===arguments.length&&"string"==typeof t)return this[0]?this[0].getAttribute(t):void 0;for(var n=0;n<this.length;n++)if(2===arguments.length)this[n].setAttribute(t,e);else for(var i in t)this[n][i]=t[i],this[n].setAttribute(i,t[i]);return this},removeAttr:function(t){for(var e=0;e<this.length;e++)this[e].removeAttribute(t);return this},data:function(t,e){var n;if(void 0!==e){for(var i=0;i<this.length;i++)(n=this[i]).dataStorage||(n.dataStorage={}),n.dataStorage[t]=e;return this}if(n=this[0]){if(n.dataStorage)return n.dataStorage[t];var r=n.getAttribute("data-".concat(t));return/^\d+\.?\d*$/.test(r)?+r:r}},append:function(){for(var t,e=0;e<arguments.length;e++){t=e<0||arguments.length<=e?void 0:arguments[e];for(var n=0;n<this.length;n++)if("string"==typeof t){var i=f.createElement("div");for(i.innerHTML=t;i.firstChild;)this[n].appendChild(i.firstChild)}else if(t instanceof l)for(var r=0;r<t.length;r++)this[n].appendChild(t[r]);else this[n].appendChild(t)}return this},appendTo:function(t){return g(t).append(this),this},insertAfter:function(t){for(var e=g(t),n=0;n<this.length;n++)if(1===e.length)e[0].parentNode.insertBefore(this[n],e[0].nextSibling);else if(1<e.length)for(var i=0;i<e.length;i++)e[i].parentNode.insertBefore(this[n].cloneNode(!0),e[i].nextSibling)},insertBefore:function(t){for(var e=g(t),n=0;n<this.length;n++)if(1===e.length)e[0].parentNode.insertBefore(this[n],e[0]);else if(1<e.length)for(var i=0;i<e.length;i++)e[i].parentNode.insertBefore(this[n].cloneNode(!0),e[i])},prepend:function(t){var e,n;for(e=0;e<this.length;e++)if("string"==typeof t){var i=f.createElement("div");for(i.innerHTML=t,n=i.childNodes.length-1;0<=n;n--)this[e].insertBefore(i.childNodes[n],this[e].childNodes[0])}else if(t instanceof l)for(n=0;n<t.length;n++)this[e].insertBefore(t[n],this[e].childNodes[0]);else this[e].insertBefore(t,this[e].childNodes[0]);return this},prependTo:function(t){return g(t).prepend(this),this},replace:function(t){for(var e,n=g(t),i=0;i<this.length;i++)(e=this[i].parentNode)&&e.replaceChild(n[0],this[i]);return this},remove:function(t){var e;if("number"!=typeof t)for(var n=0;n<this.length;n++)(e=this[n]).parentNode&&e.parentNode.removeChild(e);else(e=this[t])&&e.parentNode&&e.parentNode.removeChild(e);return this},is:function(t){var e,n,i=this[0];if(!i||void 0===t)return!1;if("string"==typeof t){if(i.matches)return i.matches(t);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(t);if(i.msMatchesSelector)return i.msMatchesSelector(t);for(e=g(t),n=0;n<e.length;n++)if(e[n]===i)return!0;return!1}if(t===f)return i===f;if(t===p)return i===p;if(t.nodeType||t instanceof l){for(e=t.nodeType?[t]:t,n=0;n<e.length;n++)if(e[n]===i)return!0;return!1}return!1},isTextNode:function(){var t=this[0];return!(!t||!t.nodeType)&&3===t.nodeType},isEmpty:function(){return!u.strip(this.text())&&!this.find("img, video, audio")[0]},isFirstChildren:function(t){return this.children().eq(0).is(t)},isLastChildren:function(t){return this.children().eq(-1).is(t)},indexOf:function(t){t instanceof l&&(t=t[0]);for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1},isInChild:function(t){for(var e,n=this[0],i=t.children(),r=0;r<i.length;r++){if((e=g(i[r])).is(n))return!0;if(e.children().length&&this.isInChild(e))return!0}return!1},every:function(t){if("function"!=typeof t)throw new TypeError("every(fn) fn is not a function");for(var e=this.length,n=2<=arguments.length?arguments[1]:void 0,i=0;i<e;i++)if(t.call(n,g(this[i]),i))return!1;return!0},text:function(t){if(void 0===t)return this[0]?this[0].textContent.trim():"";for(var e=0;e<this.length;e++)this[e].textContent=t;return this},html:function(t){if(void 0===t)return this[0]?this[0].innerHTML:"";for(var e=0;e<this.length;e++)this[e].innerHTML=t;return this},nodeName:function(){return this[0]?this[0].nodeName.toLowerCase():null},nodeType:function(){return this[0]?this[0].nodeType:0},changeNodeName:function(t){for(var e=0;e<this.length;e++)this[e]=n(this[e],t);return this},hide:function(){for(var t=0;t<this.length;t++)this[t].style.display="none";return this},show:function(){for(var t=0;t<this.length;t++){var e=this[t];"none"===e.style.display&&(e.style.display=""),"none"===p.getComputedStyle(e,null).getPropertyValue("display")&&(e.style.display="block")}return this},on:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i,r,o,s,a,h=e[0],l=e[1],c=e[2],d=0;d<this.length;d++)1!==(i=this[d]).nodeType&&i!==f&&i!==p||(o=h,s=l,a=c,(r=i).addEventListener?r.addEventListener(o,s,a):r.attachEvent?r.attachEvent(o,s):r["on".concat(o)]=s);return this},off:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i,r,o,s,a,h=e[0],l=e[1],c=e[2],d=0;d<this.length;d++)1!==(i=this[d]).nodeType&&i!==f&&i!==p||(o=h,s=l,a=c,(r=i).removeEventListener?r.removeEventListener(o,s,a):r.detachEvent?r.detachEvent(o,s):r["on".concat(o)]=null);return this},trigger:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=e[0].split(" "),r=e[1],o=0;o<i.length;o++)for(var s=i[o],a=0;a<this.length;a++){var h=this[a],l=void 0;try{l=new p.CustomEvent(s,{detail:r,bubbles:!0,cancelable:!0})}catch(t){(l=f.createEvent("Event")).initEvent(s,!0,!0),l.detail=r}h.dispatchEvent(l)}return this},css:function(t,e){var n;if(1===arguments.length){if("string"==typeof t)return this[0]?p.getComputedStyle(this[0],null).getPropertyValue(t):void 0;for(n=0;n<this.length;n+=1)for(var i in t)this[n].style[i]=t[i]}if(2===arguments.length&&"string"==typeof t)for(n=0;n<this.length;n+=1)this[n].style[t]=e;return this},styles:function(){return this[0]?p.getComputedStyle(this[0],null):{}},width:function(){return this[0]===p?p.innerWidth:0<this.length?parseFloat(this.css("width")):null},outerWidth:function(t){if(0<this.length){var e=this[0].offsetWidth;if(t){var n=this.styles();return e+parseFloat(n.getPropertyValue("margin-right"))+parseFloat(n.getPropertyValue("margin-left"))}return e}return null},height:function(){return this[0]===p?p.innerHeight:0<this.length?parseFloat(this.css("height")):null},outerHeight:function(t){if(0<this.length){var e=this[0].offsetHeight;if(t){var n=this.styles();return e+parseFloat(n.getPropertyValue("margin-top"))+parseFloat(n.getPropertyValue("margin-bottom"))}return e}return null},offset:function(){if(0<this.length){var t=this[0],e=t.getBoundingClientRect(),n=f.body,i=t.clientTop||n.clientTop||0,r=t.clientLeft||n.clientLeft||0,o=t===p?p.scrollY:t.scrollTop,s=t===p?p.scrollX:t.scrollLeft;return{top:e.top+o-i,left:e.left+s-r}}return null}};var g=function(t,e){return new l(t,e)};function d(t){this.$parent=t,this.selection=null,this.range=null,this.currentNode=null,this.timer=null;var e=t.lastChild();this.offset=e.text().length||0,e[0]&&this.setRange(e[0],this.offset)}d.prototype={constructor:d,init:function(){this.selection=window.getSelection();try{this.range=this.selection.getRangeAt(0)}catch(t){this.range=new Range}},setRange:function(t,e){var n=this;t instanceof l&&(t=t[0]),"number"==typeof e&&(this.offset=e),"number"==typeof t&&void 0===e&&(this.offset=t,t=null),null===this.selection?this.init():this.selection.removeAllRanges(),t&&(this.range.setStart(t,this.offset),this.currentNode=t),this.range.collapse(!0),this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(function(){n.selection.addRange(n.range)},100)},getCurrentNode:function(){this.selection=window.getSelection();try{this.range=this.selection.getRangeAt(0)}catch(t){this.range=new Range}return this.currentNode=this.range.endContainer,this.offset=this.range.startOffset,g(this.currentNode).isInChild(this.$parent)?g(this.currentNode):this.$parent.lastChild()}};var v={head:null,className:"",headHeight:44,headTitle:"Expansion Panel",height:260,body:null,name:"expansion-panel"};function m(t,e){var n=this;if(!e instanceof F)throw new TypeError("new ExpansionPanel() parameter error, arguments[1] is no a ZxEditor instance.");var i=this.options=Object.assign({},v,t);if((this.editorInstance=e).expansionPanels.push(this),this.visible=!1,this.name=u.toHump(i.name),this.$head=g('<div class="head-wrapper border-bottom" style="height:'.concat(i.headHeight,"px;line-height:").concat(i.headHeight,'px;">').concat(i.headTitle||"","</div>")),this.$body=g('<div class="body-wrapper" style="height:'.concat(i.height-i.headHeight,'px;"></div>')),this.$el=g('<div class="zx-editor-expansion-panel border-top out"></div>'),0<i.headHeight){if(i.head)this.$head=g(i.head);else{var r=g('<i class="switch" style="width:'.concat(i.headHeight,"px;height:").concat(i.headHeight,'px;"></i>'));this.$head.append(r),e.$eventHandlers[this.name]={$target:r,type:"click",handler:function(){n.hide()}},r.on("click",e.$eventHandlers[this.name].handler)}this.$el.append(this.$head)}try{this.$body.append(g(i.body))}catch(t){throw t}this.$el.append(this.$body),e.$editor.append(this.$el),this.init(this.options)}function y(e){return new Promise(function(n){var t=e.clipboardData,i="";if(t){var r=t.items;r&&0<r.length?function(){var t,e,n=r.length;for(t=0;t<n;t++)e=r[t],/^text\/plain/.test(e.type)?e.getAsString(function(t){i+=t,o(0,n)}):o(0,n)}():n("")}else n("");function o(t,e){++t===e&&n(u.strip(i))}})}function b(){var t;for(var e in this.$eventHandlers.contentPaste={$target:this.$content,type:"paste",handler:function(t){var e=this;t.preventDefault(),y(t).then(function(t){e.insertElm(u.removeHtmlTags(t))})}.bind(this)},this.$eventHandlers.windowResize={$target:g(window),type:"resize",handler:function(){this.toolbar.init(),this.emit("windowResize",this)}.bind(this)},this.$eventHandlers.contentInput={$target:this.$content,type:"input",handler:function(){this._checkEmpty(),this.emit("contentChange",this)}.bind(this)},this.$eventHandlers.contentFocus={$target:this.$content,type:"focus",handler:function(){this.options.toolbarBeenFixed||this.toolbar.show()}.bind(this)},this.$eventHandlers.contentBlur={$target:this.$content,type:"blur",handler:function(){this.options.toolbarBeenFixed||this.toolbar.hide()}.bind(this)},this.$eventHandlers)(t=this.$eventHandlers[e]).$target.on(t.type,t.handler,t.capture)}function w(t,e){t&&"string"==typeof t&&e&&"function"==typeof e&&(this.customEvents[t]||(this.customEvents[t]=[]),this.customEvents[t].push(e))}function x(t){var e=this.customEvents[t];if(e)for(var n=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++)try{e[i].apply(null,n)}catch(t){this.emit("error",t)}}function E(t,e){if(this.customEvents[t])if("function"==typeof e&&this.customEvents[t]){var n=this.customEvents[t].findIndex(function(t){return t===e});0<=n&&this.customEvents[t].splice(n,1)}else this.customEvents[t]=null,delete this.customEvents[t]}function $(t,e,n,i){var r=new Image;r.src=t,r.setAttribute("alt",e.name),r.onload=function(){i(null,1<n?function(t,e,n){var i=f.createElement("canvas"),r=i.getContext("2d"),o=t.width,s=t.height;switch(i.width=o,i.height=s,e){case 6:i.width=s,i.height=o,r.rotate(Math.PI/2),r.drawImage(t,0,-s,o,s);break;case 3:r.rotate(Math.PI),r.drawImage(t,-o,-s,o,s);break;case 8:i.width=s,i.height=o,r.rotate(3*Math.PI/2),r.drawImage(t,-o,0,o,s);break;default:r.drawImage(t,0,0,o,s)}var a=i.toDataURL(opts.type);t.src=a;var h={element:t,base64:a,width:i.width,height:i.height};return i=null,h}(r,n,e.type):{element:r,base64:t,width:r.width,height:r.height,file:e})},r.onerror=function(t){i(t)}}function C(t,e){var n=f.createElement("canvas");return n.width=e.cw,n.height=e.ch,n.getContext("2d").drawImage(t,e.sx,e.sy,e.sw,e.sh,0,0,n.width,n.height),n}function N(t,e){return parseInt(t/e*1e4)/1e4}var H={imageMaxSize:null,ignoreGif:!0,forceResize:!(m.prototype={constructor:m,init:function(t){t=t||this.options;var e=window.innerHeight;this.$el.css({height:"".concat(t.height,"px"),top:e-t.height+"px"})},show:function(){this.visible||(this.$el.removeClass("out").addClass("in"),this.visible=!0,this.editorInstance.emit("expansionPanelShow",this,this.editorInstance))},hide:function(){this.visible&&(this.$el.removeClass("in").addClass("out"),this.visible=!1,this.editorInstance.emit("expansionPanelHide",this,this.editorInstance))}})};function S(t){var e,n;if(!/^data:(\w+\/\w+);base64,(.+)/.test(t))throw new TypeError("base64ToBlobData(base64Data), base64Data non-base64 data!");e=RegExp.$1,n=RegExp.$2;for(var i=p.atob(n),r=new Uint8Array(i.length),o=0;o<i.length;o++)r[o]=i.charCodeAt(o);return new Blob([r],{type:e})}function T(i,r){var t=this;return new Promise(function(e,n){if(!i||!i instanceof File)throw new TypeError("file is not a File object");t.options&&(r=Object.assign({},H,r)),/image\/.*/.test(i.type)?void 0===p.EXIF?(r.orientation=0,_(i,r).then(e).catch(n)):p.EXIF.getData(i,function(){var t=p.EXIF.getAllTags(this)||{};r.orientation=t.Orientation,_(i,r).then(e).catch(n)}):n(new TypeError('"'.concat(i.name,'" is not Image File!')))})}function I(t){return p.URL.createObjectURL(t)}function _(o,s){return new Promise(function(i,r){var t=new FileReader;t.readAsDataURL(o),t.onload=function(){$(this.result,o,s.orientation,function(t,e){if(t)r(t);else if("image/gif"===o.type&&s.ignoreGif)i(function(r){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},e=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),e.forEach(function(t){var e,n,i;e=r,i=o[n=t],n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i})}return r}({},e,{type:o.type,size:o.size,name:o.name}));else{var n=function(t,e){var n=t.file.type,i=function(t,e,n){var i=u.int(n.width),r=u.int(n.height);if(!n.forceResize&&0<i&&t<i&&0<r&&e<r)return{sx:0,sy:0,sw:t,sh:e,scaling:1,cw:t,ch:e};var o=1,s=0,a=0,h=t,l=e,c=0,d=0;return 0<i&&0<r?(l=r,c=h=i,d=Math.floor(i*e/t),o=N(t,i),a=r<=d?(s=0,u.int((d-r)/2*o)):(o=N(e,r),c=Math.floor(r*t/e),d=r,s=u.int((c-i)/2*o),0)):0<i?(o=N(t,i),h=i,l=Math.floor(i*e/t)):0<r&&(o=N(e,r),h=Math.floor(r*t/e),l=r),{sx:s,sy:a,sw:u.int(h*o),sh:u.int(l*o),scaling:o,cw:h,ch:l}}(t.width,t.height,e),r=t.element,o=2,s=i.sw,a=i.sh,h=i.sx,l=i.sy;if(i.scaling>o)for(o=i.scaling;r=C(r,{cw:i.cw*o,ch:i.ch*o,sx:h,sy:l,sw:s,sh:a}),s=r.width,a=r.height,h=l=0,2<(o-=1););var c=(r=C(r,{cw:i.cw,ch:i.ch,sx:h,sy:l,sw:s,sh:a})).toDataURL(n),d=S(c);return{element:r,type:n,width:i.cw,height:i.ch,data:d,base64:c,size:d.size,url:I(d),rawData:t}}(e,s);0<s.imageMaxSize&&n.size/1024>s.imageMaxSize?r(new RangeError('File size "'.concat(n.size/1024,'" out of range, limit is ').concat(s.imageMaxSize,"Kib"))):i(n)}})},t.onerror=r})}var A=200,P={name:"",className:"",el:null,innerHtml:"",style:"",events:null};function t(t,e){this.editorInstance=e,this.options=t,this.visible=t.toolbarBeenFixed,this.height=t.toolbarHeight,this.$el=g('<div class="zx-editor-toolbar-wrapper border-top '.concat(this.visible?"in":"out",'" style="height:').concat(this.height+A,'px;"><dl class="inner-wrapper" style="height:').concat(this.height,'px;"></dl></div>')),e.$editor.append(this.$el),this.init(t)}var z={black:"#333",gray:"#d0d0d0",red:"#ff583d",yellow:"#fdaa25",green:"#44c67b",blue:"#14b2e0",purple:"#b065e2"};function B(e){var n=this;this.toolbar=new t(e,this),e.toolbarBtns.forEach(function(t){"select-picture"===t?n.toolbar.addButton(function(e){var i=this,t=g('<label class="toolbar-icon-pic" style="position:absolute;top:0;left:0;width:100%;height:100%;"></label>'),n=g('<input type="file" accept="image/*" style="display:none">');t.append(n);var r=n[0];this.$eventHandlers.selectPictureInputClick={$target:n,type:"click",handler:function(){r.value=""},capture:!1};var o=/^<section\b.*<\/section>$/.test(e.imageSectionTemp)?e.imageSectionTemp:'<section><img src="{url}"></section>',s={imageMaxSize:e.imageMaxSize,width:e.imageMaxWidth};return this.$eventHandlers.selectPictureInputChange={$target:n,type:"change",handler:function(t){var n=r.files[0];i.emit("selectPictureInputChange",n,t,i),e.customizePictureHandler||i.fileToBase64(n,s).then(function(t){var e=g(o.replace("{url}",t.base64));e.find("img").attr({id:"zxEditor_img_"+ +new Date,alt:n.name}),i.insertElm(e)}).catch(function(t){i.emit("error",t,"handlePictureFile")})},capture:!1},{name:"select-picture",el:t}}.call(n,e)):"text-style"===t&&n.toolbar.addButton(function(t){var e=this,n=Object.assign({},z,t.textStyleColors),i='<dl class="__color-wrapper border-bottom"><dd class="active __black" data-color=""></dd><dd class="__gray" data-color="'.concat(n.gray,'"></dd><dd class="__red" data-color="').concat(n.red,'"></dd><dd class="__yellow" data-color="').concat(n.yellow,'"></dd><dd class="__green" data-color="').concat(n.green,'"></dd><dd class="__blue" data-color="').concat(n.blue,'"></dd><dd class="__purple" data-color="').concat(n.purple,'"></dd></dl>'),r='<div class="text-style-outer-wrapper">'.concat('<dl class="__style-wrapper border-bottom"><dd class="text-bold" data-style="fontWeight:800">B</dd><dd class="text-italic" data-style="fontStyle:italic">I</dd><dd class="through-line" data-style="textDecoration:line-through">abc</dd></dl>'+i+'<dl class="__tag-wrapper"><dd class="__h2" data-tag="h2">å¤§æ é¢<i></i></dd><dd class="__h4" data-tag="h4">å°æ é¢<i></i></dd><dd class="__p" data-tag="p">æ­£æ<i class="checked"></i></dd><dd class="__blockquote" data-tag="blockquote"><b></b>å¼ç¨<i></i></dd><dd class="__ul" data-tag="ul"><b></b>æ åºåè¡¨<i></i></dd></dl>',"</div>"),o={headTitle:"Text Style",body:g(r)};return this.textStylePanel=new m(o,this),{name:"text-style",className:"text-style-btn",events:{type:"click",handler:function(){e.textStylePanel.show()}}}}.call(n,e))})}var L={disableBackspaceDelete:!0,editable:!0,height:null,fixedHeight:!(t.prototype={constructor:t,init:function(t){t=t||this.options;var e=p.innerHeight;this.$el.css({top:e-t.toolbarHeight+"px"}),this.visible&&this.editorInstance.emit("toolbarShow",this,this.editorInstance)},show:function(){this.visible||(this.$el.removeClass("out").addClass("in"),this.visible=!0,this.editorInstance.emit("toolbarShow",this,this.editorInstance))},hide:function(){this.visible&&(this.$el.removeClass("in").addClass("out"),this.visible=!1,this.editorInstance.emit("toolbarHide",this,this.editorInstance))},addButton:function(t,e){var n=this,i=Object.assign({},P,t);i.name||(i.name="toolbar-btn-"+ +new Date);var r=g('<dd class="icon-item" data-name="'.concat(i.name,'" style="').concat(i.style,'"></dd>'));i.el&&"object"===c(i.el)?r.append(g(i.el)):r.html(i.innerHtml),i.className&&r.addClass(i.className);var o={};this.options.toolbarHeight&&(o.width=o.height=this.options.toolbarHeight+"px"),r.css(o);var s=this.$el.find(".inner-wrapper").children();if("number"==typeof e&&e<s.length?r.insertBefore(s[e]):this.$el.find(".inner-wrapper").append(r),i.events){var a,h;u.isObject(i.events)?(a=[]).push(i.events):Array.isArray(i.events)&&(a=i.events);var l=this.editorInstance.$eventHandlers;a.forEach(function(t){if(!t||"string"!=typeof t.type||"function"!=typeof t.handler)throw new TypeError("Function addButton(opts), opts.events's parameter error.");h="toolbarBtnEvent_".concat(t.name),l[h]={$target:r,type:t.type,handler:t.handler.bind(n.editorInstance),capture:"boolean"==typeof t.capture&&t.capture},r.on(t.type,l[h].handler,l[h].capture)})}}}),placeholder:"",placeholderColor:"",lineHeight:1.5,padding:"",cursorColor:"",toolbarBeenFixed:!0,toolbarHeight:50,toolbarBtns:["select-picture","text-style"],customizePictureHandler:!1,imageMaxWidth:720,imageMaxSize:10240,imageSectionTemp:'<section><img src="{url}"></section>',textStyleColors:{},borderColor:""};function F(t,e){if(!this instanceof F)throw new Error("ZxEditor is a constructor and should be called with the `new` keyword");if(this.$wrapper=g(t),!this.$wrapper[0])throw new Error("Cann't found '".concat(t,"' Node in document!"));this.version="3.0.0-alpha",this.$=g,this.ExpansionPanel=m,this.options=Object.assign(L,e),this.init(this.options)}return F.prototype={constructor:F,init:function(t){t=t||this.options,this.$eventHandlers={},this.customEvents={},function(t){for(var e in t.prototype.on=w,t.prototype.emit=x,t.prototype.off=E,t.prototype.getPasteText=y,u)u.hasOwnProperty(e)&&(t.prototype[e]=u[e]);t.prototype.blobToUrl=I,t.prototype.base64ToBlobData=S,t.prototype.fileToBase64=T}(F),function(){var e=this;this.on("toolbarShow",function(t){e.$content.css("padding-bottom",t.height+"px")}),this.on("toolbarHide",function(){e.$content.css("padding-bottom",0)})}.call(this),this.expansionPanels=[],function(t){this.$content=g('<div class="zx-editor-content-wrapper is-empty" contenteditable="'.concat(t.editable,'"><section><br></section></div>')),this.$editor=g('<div class="zx-editor"></div>'),this.$editor.append(this.$content),this.$wrapper.append(this.$editor)}.call(this,t),B.call(this,t),function(t){var e="";if(t.lineHeight||t.cursorColor){var n=t.lineHeight?"line-height:".concat(t.lineHeight,";"):"",i=t.cursorColor?"caret-color:".concat(t.cursorColor):"";e+=".zx-editor .zx-editor-content-wrapper{".concat(n+i,"}")}if(t.padding&&(e+=".zx-editor .zx-editor-content-wrapper > section{padding:".concat(t.padding,";}")),t.placeholder||t.placeholderColor){var r=t.placeholder?"content:'".concat(t.placeholder,"';"):"",o=t.placeholderColor?"color:".concat(t.placeholderColor,";"):"";e+=".zx-editor .zx-editor-content-wrapper.is-empty:before{".concat(r+o,"}")}t.borderColor&&(e+=".zx-editor .border-top:before, .zx-editor .border-bottom:after {border-color: ".concat(t.borderColor)),e&&g("head").append('<style type="text/css">'.concat(e,"</style>"));var s=this.$wrapper.outerHeight(!0)-this.$wrapper.height();this.setHeight(t.height?t.height:window.innerHeight-s)}.call(this,t),this.cursor=new d(this.$content),b.call(this)},insertElm:function(t){if(t){var e,n,i=this.cursor.getCurrentNode();if("string"==typeof t)if(i.isEmpty())i.text(t),e=i[0].childNodes[0],n=t.length;else if(i.children().every(function(t){return t.isTextNode()})){var r=this.cursor.offset,o=i.text(),s=o.substr(0,r)+t+o.substr(r);i.text(s),e=i[0].childNodes[0],n=t.length+r}else{var a=g("<section>".concat(t,"</section>"));a.insertAfter(i),e=a[0].childNodes[0],n=t.length}else for(var h,l=g(t),c=0;c<l.length;c++){var d=(h=g(l[c])).nodeName();if("section"!==d)if(1!==h.nodeType()||/video|img|audio/.test(d))h=g("<section></section>").append(h);else h.changeNodeName("section");if(i.isEmpty()?i.next()[0]&&i.next().isEmpty()?i.replace(h):h.insertBefore(i):h.insertAfter(i),h.next()[0])n=h.lastChild().isTextNode()?(e=h.lastChild()[0],h.lastChild().text().length):(e=h[0],1);else{var u=g("<section><br></section>");this.$content.append(u),e=u[0],n=0}}this._checkChildSection(),this.$content.trigger("input"),this.cursor.setRange(e,n)}},insertBlankLine:function(){var t=g("<section><br></section>");this.insertElm(t),this.cursor.setRange(t[0],0)},_checkEmpty:function(){var t=this.$content;t.isEmpty()?t.addClass("is-empty"):t.hasClass("is-empty")&&t.removeClass("is-empty")},_checkChildSection:function(){for(var t,e=this.$content[0],n=e.childNodes,i=0;i<n.length;i++)if(1===(t=n[i]).nodeType)"SECTION"!==t.nodeName&&u.changeNodeName(t,"section");else{var r=g("<section></section>");r.append(t.cloneNode()),e.replaceChild(r[0],t)}},remove:function(){this.setHtml()},setHtml:function(t){this.$content.html(t||"<section><br></section>"),this._checkChildSection(),this.cursor.setRange(this.$content.firstChild()[0],0),this.$content.trigger("input")},getHtml:function(){return this.$content.html()},getText:function(){return this.$content.text()},destroy:function(){var t;for(var e in this.$eventHandlers)(t=this.$eventHandlers[e]).$target.off(t.type,t.handler,t.capture),delete this.$eventHandlers[e];for(var n in this.customEvents)t=this.customEvents[n],this.off(n);for(var i in this.cursor=null,this.toolbar=null,this)this[i]instanceof m&&(this[i]=null);this.$editor.remove()},setHeight:function(t){this.$content.css("height","number"==typeof t?t+"px":t),this.emit("heightChange",this)},getBase64Images:function(){for(var t,e,n=[],i=this.$content.find("img"),r=0;r<i.length;r++)e=(t=i[r]).src,/^data:.+?;base64,/.test(e)&&n.push({id:t.id,base64:e,blob:S(e)});return n},setImageSrc:function(t,e){var n=this.$content.find("#"+t)[0];return!!n&&(n.src=e,n.removeAttribute("id"),!0)}},F});
//# sourceMappingURL=zx-editor.min.js.map
